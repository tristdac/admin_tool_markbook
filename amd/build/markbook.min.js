define(["jquery","core/ajax","core/notification","core/modal_factory"],function(e,t,s,i){return{init:function(t,s){if(e(".path-mod").length>0)if(e("fieldset#id_modstandardgrade").length>0){var i=e("#id_assessmenttype").find(":selected").attr("value"),a=e("#id_assessmenttype").find(":selected").text();function d(){e('.field_assessmentname .form-autocomplete-multiple span[role="option"]').each(function(){var t=e(this).attr("data-value");e('<div class="rewrite redate"><a id="redate-'+t+'"><i class="fa fa-calendar"></i> Write Assessment Dates</a></div>').insertAfter(e(this)),e('<div class="rewrite append"><a id="append-'+t+'"><i class="fa fa-plus"></i> Append Activity Name</a></div>').insertAfter(e(this)),e('<div class="rewrite rename"><a id="rename-'+t+'"><i class="fa fa-refresh"></i> Rename Activity</a></div>').insertAfter(e(this))})}function n(){e("#id_submitbutton").prop("disabled",!0),e("#id_submitbutton2").prop("disabled",!0)}function l(){e("#id_submitbutton").prop("disabled",!1),e("#id_submitbutton2").prop("disabled",!1)}function o(){e('#id_markbooksection .form-autocomplete-selection span.tag.badge span[aria-hidden="true"]').trigger("click")}e('[data-groupname="gradingduedate"]').addClass("show"),e("#id_availability .moreless-toggler").addClass("moreless-less").text("Show less..."),e("select option[value='0']").prop("disabled",!0),e("#id_assessmentname").parent().append('<div class="rename"><a id="rename" style="margin:0;cursor:pointer;"><i class="fa fa-refresh"></i> Rename Activity</a></div>'),"true"==e(".field_assessmentname span[role='option']").attr("data-active-selection")&&e(".field_assessmentname").addClass("hidden"),"1"==i&&e(".field_assessmentname").addClass("hidden"),"2"==i&&e(".field_assessmentname").removeClass("hidden"),"3"==i&&e(".field_assessmentname").removeClass("hidden"),e(".form-autocomplete-selection").change(function(){setTimeout(d,500)}),e("select#id_assessmenttype").change(function(){e(".form-autocomplete-selection").find('span[role="option"]').length;"1"==e(this).val()&&(e(".field_assessmentname").addClass("hidden"),o(),l()),"2"==e(this).val()&&(e(".field_assessmentname").removeClass("hidden"),e("#settitle").addClass("hidden"),e("#appendtitle").addClass("hidden"),e("select option[value='0']").prop("disabled",!0),e(".field_assessmentname").addClass("highlight"),o(),n()),"3"==e(this).val()&&(e(".field_assessmentname").removeClass("hidden"),e("#settitle").addClass("hidden"),e("#appendtitle").addClass("hidden"),e("select option[value='0']").prop("disabled",!0),e(".field_assessmentname").addClass("highlight"),n(),o())}),e(".field_assessmentname").on("click","li",function(){var t=e("#id_assessmenttype").find(":selected").attr("value"),s=e(this).attr("data-value"),i=e(this).text(),a=[],n=[];e("#asslist").find(".milestone-li").each(function(){a.push(this.id)}),e("#asslist").find(".summative-li").each(function(){n.push(this.id)}),-1!==e.inArray(s,a)&&"2"==t&&alert(i+" is already being used elsewhere in Moodle. Its fine for multiple acitivies to count towards the same Milestone, but is important that you are aware of all Milestone activities. See below for further details."),-1!==e.inArray(s,n)&&"2"==t&&(alert(i+" is already being used Summatively elsewhere in Moodle. You cannot assign this as a Milestone assessment. See below for further details."),e('#id_markbooksection span.tag.badge[data-value="'+s+'"] span[aria-hidden="true"]').trigger("click")),-1===e.inArray(s,a)&&-1===e.inArray(s,n)||"3"!=t||(alert(s+" "+i+" is already being used elsewhere in Moodle. You cannot use this summatively until it has been unassigned elsewhere. See below for further details."),setTimeout(function(){e('#id_markbooksection .form-autocomplete-selection span[data-value="'+s+'"] span[aria-hidden="true"]').trigger("click")},500)),e('.field_assessmentname .form-autocomplete-suggestions li[aria-selected="true"]').length>0&&(e(".field_assessmentname").removeClass("highlight"),e(".field_assessmentname #message").remove(),l()),setTimeout(d,500)}),e(".field_assessmentname").on("click",".form-autocomplete-multiple span",function(){e('.field_assessmentname .form-autocomplete-multiple span[aria-selected="true"]').length<=1&&(e(".field_assessmentname").addClass("highlight"),n())}),"0"==i&&(e(".field_assessmentname").addClass("hidden"),e(".field_assessmenttype").addClass("highlight"),e(".field_assessmenttype .fselect").append("<span id='message' style='text-align:center;padding:15px;font-weight:strong;'>Please select Assessment Type</span>"),e("fieldset:nth-last-child(2)").removeClass("collapsed"),n()),e("#id_assessmenttype").on("change",function(){e(".field_assessmenttype").removeClass("highlight"),e(".field_assessmenttype #message").remove()}),e(".field_assessmentname .form-autocomplete-multiple").find(".badge").each(function(){e(this).after('<div class="settitle"><a id="settitle" style="margin:0;cursor:pointer;"><i class="fa fa-refresh"></i> Set Title</a></div>');var t=e(this).text().substring(15);e("#id_name").attr("value",a+" Assessment: "+t)}),e(".field_assessmentname").on("click",".rewrite.rename",function(){var s=e(this).find("a").attr("id").substr(7),i=e(".form-autocomplete-suggestions").find("li[data-value='"+s+"']").text(),a=(i=t[s].AssessmentTitle+" - "+t[s].AssessmentCode,e("#id_assessmenttype").find(":selected").text());e("#id_name").attr("value",a+" Assessment: "+i),alert("Activity title has changed to '"+a+" Assessment: "+i+"'")}),e(".field_assessmentname").on("click",".rewrite.append",function(){var s=e(this).find("a").attr("id").substr(7),i=e(".form-autocomplete-suggestions").find("li[data-value='"+s+"']").text();i=t[s].AssessmentTitle+" - "+t[s].AssessmentCode;e("#id_name").val(e("#id_name").val()+" ("+i+")"),alert("Activity title has been appended with '("+i+")'")}),e(".field_assessmentname").on("click",".rewrite.redate",function(){var s=e(this).find("a").attr("id").substr(7),i=t[s].setD,a=t[s].setM,d=t[s].setY,n=t[s].setH,l=t[s].setI,o=t[s].expD,r=t[s].expM,m=t[s].expY,c=t[s].expH,u=t[s].expI;e('[data-groupname="duedate"]').find('[disabled="disabled"]').removeAttr("disabled"),e("#id_duedate_enabled").attr("checked","checked"),e('[data-groupname="gradingduedate"]').find('[disabled="disabled"]').removeAttr("disabled"),e("#id_gradingduedate_enabled").attr("checked","checked"),e("#id_duedate_day").find("option[selected]").removeAttr("selected"),e("#id_duedate_day").find("option[value='"+i+"']").attr("selected","selected"),e("#id_duedate_month").find("option[selected]").removeAttr("selected"),e("#id_duedate_month").find("option[value='"+a+"']").attr("selected","selected"),e("#id_duedate_year").find("option[selected]").removeAttr("selected"),e("#id_duedate_year").find("option[value='"+d+"']").attr("selected","selected"),e("#id_duedate_hour").find("option[selected]").removeAttr("selected"),e("#id_duedate_hour").find("option[value='"+n+"']").attr("selected","selected"),e("#id_duedate_minute").find("option[selected]").removeAttr("selected"),e("#id_duedate_minute").find("option[value='"+l+"']").attr("selected","selected"),e("#id_gradingduedate_day").find("option[selected]").removeAttr("selected"),e("#id_gradingduedate_day").find("option[value='"+o+"']").attr("selected","selected"),e("#id_gradingduedate_month").find("option[selected]").removeAttr("selected"),e("#id_gradingduedate_month").find("option[value='"+r+"']").attr("selected","selected"),e("#id_gradingduedate_year").find("option[selected]").removeAttr("selected"),e("#id_gradingduedate_year").find("option[value='"+m+"']").attr("selected","selected"),e("#id_gradingduedate_hour").find("option[selected]").removeAttr("selected"),e("#id_gradingduedate_hour").find("option[value='"+c+"']").attr("selected","selected"),e("#id_gradingduedate_minute").find("option[selected]").removeAttr("selected"),e("#id_gradingduedate_minute").find("option[value='"+u+"']").attr("selected","selected"),e("#id_allowsubmissionsfromdate_day").find("option[selected]").removeAttr("selected"),e("#id_allowsubmissionsfromdate_day").find("option[value='"+o+"']").attr("selected","selected"),e("#id_allowsubmissionsfromdate_month").find("option[selected]").removeAttr("selected"),e("#id_allowsubmissionsfromdate_month").find("option[value='"+r+"']").attr("selected","selected"),e("#id_allowsubmissionsfromdate_year").find("option[selected]").removeAttr("selected"),e("#id_allowsubmissionsfromdate_year").find("option[value='"+m+"']").attr("selected","selected"),e("#id_allowsubmissionsfromdate_hour").find("option[selected]").removeAttr("selected"),e("#id_allowsubmissionsfromdate_hour").find("option[value='"+c+"']").attr("selected","selected"),e("#id_allowsubmissionsfromdate_minute").find("option[selected]").removeAttr("selected"),e("#id_allowsubmissionsfromdate_minute").find("option[value='"+u+"']").attr("selected","selected"),window.location.hash="#id_availability",e(function(){var t=e(".site-navbar").height();return e("html, body").animate({scrollTop:e("#id_availability").offset().top-t},500),!1}),alert("'Due date' and 'grade by' date applied from Markbook")}),e(document).ready(function(){setTimeout(d,2e3)}),e("body").on("click",'input[id*="id_submitbutton"][disabled=""]',function(){alert("disabled alert"),e("#id_markbooksection").effect("highlight",{color:"#f4ab45"},3e3)})}else e("#id_markbooksection").remove()}}});